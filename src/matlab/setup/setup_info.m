function ex = setup_info(ex)

t = datetime('now', 'TimeZone', 'UTC', 'Format', 'yyyy-MM-dd HH:mm:ss');
rng('default')

% Experiment information
ex.info.experiment = struct( ...
    'facility_name',         'Sisneros Laboratory', ...
    'experimenter_name',     'Aoi Hunsaker', ...
    'exp_date',              datestr(t, 'yyyymmdd'), ...
    'exp_time_start',        datestr(t, 'HHMMSS'), ...
    'exp_time_end',          NaN, ... % Will be assigned in finish_experiment
    'exp_duration',          NaN, ... % Will be assigned in finish_experiment
    'drug_name',             'Anesthetic: Benzocaine sulfate; Paralytic: Cisatracurium besylate', ...
    'drug_delivery_method',  'Anesthetic: Bath; Paralytic: Injection', ...      % bath / injection / none
    'drug_concentration',    'Anesthetic: 0.025% ; Paralytic: 3 mg kg−1 ', ...
    'target_water_temp_C',    10, ...
    'water_temp_tol_C',       3, ...
    'water_salinity',         27, ...
    'water_depth',            'Need to measure', ...
    'tank_dimensions',        'X liter circular tank (X mm inside diameter)', ...
    'tank_material',          'High density polyethelene', ...
    'tank_isolation_method',  'Floating table', ...
    'noise_floor',            NaN, ... % Measure during setup
    'random_seed',            "default" ...
    );

% Animal information
ex.info.animal = struct( ...
    'species_name',          'hydrolgus_colliei', ...
    'subject_ID',            NaN, ... % In app
    'sex',                   NaN, ... % In app
    'standard_length_mm',    NaN, ... % Enter manually in finish_experiment.m
    'body_mass_g',           NaN, ... % Enter manually in finish_experiment.m
    'developmental_stage',   'adult', ...
    'health',                NaN, ... % In app
    'source',                'via trawl at San Juan Island Friday Harbor', ...
    'collection_date',       '2026-03-02', ...
    'housing',               'Indoor holding tanks', ...
    'diet',                  'Mixed diet shrimp and squid', ...
    'acclimation_period',    '1 day', ...
    'IACUC_protocol_ID',     'University of Washington Animal Care and Use Committee', ...
    'collection_permit',     'Washington State Scientific Collection Permit from Department of Fish and Wildlife', ...
    'filename_root',         NaN ...
    );

% Stimulus parameters
ex.info.stimulus = struct( ...
    'frequency_hz',                         NaN, ... % In app
    'amplitude_spl',                        NaN, ... % dB SPL re 1 micro Pascal, Value changes later in prepare_next_amp
    'spl_reference',                        '20 micro Pascal', ... % dB SPL re 1 micro Pascal, Value changes later
    'type',                                 NaN, ... % Set in GUI
    'polarity',                             'alternating', ...
    'waveform',                             NaN, ...
    'ramp_type',                            'cosine', ...
    'full_amplitude_duration_ms',           50, ... %# check if these are good parameters for the duration (ms) Nieder et al. 2023, check the spectra of this to make sure it is not too broadband
    'ramp_duration_ms',                     10, ... % Set in app (10 ms)
    'speaker_model',                        'UW-30 Lubell Labs Inc., Columbus, OH, USA Serial #', ...
    'max_amplitude_limit',                  140, ...
    'speaker_orientation',                  'centered under fish', ...
    'speaker_distance_from_head',            NaN ... % Determine later
    );

% Channel parameters
ex.info.channels = struct( ...
    'n_channels',             4, ...
    'names',                 {{'L','R','Forebrain','Abdomen'}}, ...
    'reference_location',    'tail', ...
    'ground_location',       'in water', ...
    'electrode_type',        'Subdermal, differential measurment, stainless steel, 27 gauge, 13 mm, Rochester Electromedical Inc.; Coral Springs, FL, USA', ...
    'electrode_depth',       '3 mm' ...
    );

% Recording parameters
    ex.info.recording.sampling_rate_hz = 500*2*5; % (highest presented stimulus)*(nyquist)*(signal quality)
    ex.info.recording.ADC_bit_depth = NaN;
    ex.info.recording.latency_samples = NaN;
    ex.info.recording.DAC_model_serial = 'USB D/A Converter, Fireface UCX, RME, Frankfurt, Germany';
    ex.info.recording.DAC_conversion_factor = 1/0.2044; % Multiply by this factor to recover true voltage value 
    ex.info.recording.DAC_output_channels = [1 4];
    ex.info.recording.DAC_output_channel_names = {'UW30', 'Loopback'};
    ex.info.recording.DAC_input_channels = [3:8];
    ex.info.recording.DAC_input_channel_names = {'Hydrophone', 'Loopback', 'Ch1', 'Ch2','Ch3','Ch4'};
    ex.info.recording.hydrophone_model = 'Type 8103, Bruel & Kjaer, Nærum, Denmark, Serial #: ';
    ex.info.recording.hydrophone_gain_V_per_Pa = 0.1; % or 100 mV/Pa
    ex.info.recording.bioamplifier_model_serial = 'BMA-400, CWE Inc. Ardmore, PA, USA';
    ex.info.recording.bioamp_gain = 10000;
    ex.info.recording.hydrophone_voltage_scaling_factor_V = ex.info.recording.DAC_conversion_factor;
    ex.info.recording.electrode_voltage_scaling_factor_V = ex.info.recording.DAC_conversion_factor/ ex.info.recording.bioamp_gain;
    ex.info.recording.audio_amplifier = 'Power amplifier, Crown D75-A, Harman, Northridge, CA, USA';
    ex.info.recording.amplifier_gain = 'Need to measure';

% Adaptive testing parameters
ex.info.adaptive = struct( ...
    'response_feature',                   'double_frequency_response', ... % Make this an if statement so it will generate which frequency to look for in the response
    'target_response_frequency',           ex.info.stimulus.frequency_hz*2, ... % Auto populate
    'trials_per_block',                    10, ... % Must be an even number of equal number of stimulus +/- polarities in block
    'min_trials_needed_for_analysis',      40, ...
    'max_trials',                          NaN ... % Set in GUI
    );

% Signal preprocessing parameters
ex.info.signal_quality = struct( ...
    'filter_type',               'butterworth', ...
    'bandpass_low_Hz',           40, ...
    'bandpass_high_Hz',          1000, ...
    'artifact_detection_method', 'standard deviation', ...
    'rejection_threshold_sd',    3 ...
    );

% Response modeling parameters
ex.info.model = struct( ... % These values will be updated by prepare_next_amplitude when new amplitude is selected
    'initial_x0',         130, ...
    'initial_kappa',      1, ...
    'initial_lambda',     1, ...
    'initial_max_resp',   5, ...
    'response_fn',        @(params, x) (params(3) ./ (1 + exp(-params(2) * (x - params(1))))) .* params(4), ...
    'initial_x_vector',           NaN, ...
    'initial_y_vector',           NaN ...
    );

% Response modeling parameters
ex.info.calibration = struct( ... % These values will be updated by prepare_next_amplitude when new amplitude is selected
    'hydrophone_amplitude_convention',   'SPL', ...
    'target_amp_spl',           130, ...
    'correction_factor_dB',     NaN, ... % output from calibration GUI will generate this
    'correction_factor_linear',     NaN, ... % output from calibration GUI will generate this
    'correction_tolerance_dB',     5, ... % output from calibration GUI will generate this
    'signals',     NaN, ... % output from calibration GUI will generate this
    'initial_calibration_complete',                    NaN, ... % auto generate here
    'check_passed',                    NaN, ... % auto generate here
    'file_name',    '' ... % auto generate here
    );

